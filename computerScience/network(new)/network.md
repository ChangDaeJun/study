## 네트워크 통신

### 유니캐스트(one-to-one)
* 출발지와 목적지가 정해진 통신 방식이다.
* 일반적인 통신 상황에서는 해당 방식을 사용한다.

### 브로드캐스트(one-to-all)
* 출발지는 정해져있지만, 목적지 ip를 1로 적어 보낸다. 네트워크 내 모든 장치에 해당 패킷이 전달되게 된다.
* 주로 DHCP, ARP가 해당 방식을 사용한다.

### 멀티캐스트(one-to-many)
* 목적지 그룹에게 동시에 여러 패킷을 전달한다.
* 한번의 전송으로 여러 그룹에게 패킷을 전달하기 때문에, 서버 부하를 감소시킬 수 있다.
* IPTV, 사내 방송, 증권 시세 방송 등 단뱡향으로 다수에게 같은 내용을 전달할 때 사용한다.


### 애니캐스트(one-to-nearest)
* 가장 가까운(비용이 저렴한) 장치로 패킷을 전달한다.
* DNS, CDN에서 해당 방식을 사용한다.

| 이름                    | 통신방식          | 사례                    |
|-----------------------|---------------|-----------------------|
| 유니캐스트(one-to-one)     | 출발지와 목적지가 정해짐 | 일반적인 통신               |
| 브로드캐스트(one-to-all)    | 목적지가 네트워크 전체  | DHCP, ARP             |
| 멀티캐스트(one-to-many)    | 목적지가 특정 그룹    | IPTV, 사내 방송, 증권 시세 방송 |
| 애니캐스트(one-to-nearest) | 목적지가 가장 가까운 곳 | DNS, CDN              |

### BUM 트래픽
* Broadcast, Unknown unicast, Multicast을 의미한다.
* Unknown unicast는 유니캐스트이지만, 스위치가 목적지 주소를 알지 못해, 패킷을 모든 포트로 전송하는 경우를 의미한다.
* 불필요한 BUM 트래픽은 네트워크 성능을 저하시킨다.
* 이더넷 환경에서는 ARP 브로드캐스트 이후 통신이 시작되게이 BUM 트래픽이 많이 발생하지 않는다.

## MAC 주소
* Media Access Control, 2계층 통신을 위한 네트워크 인터페이스에 할당된 식별자

### MAC 주소 체계
* MAC 주소는 하드웨어에 고정되어 출하되어 변경이 힘들다.
* 각 제조업체가 자체적으로 할당하며, IEEE가 관리한다.
* MAC 주소 = OUI(6자리, 제조사 코드) + UAA(6자리, 제조사 자체 할당)
* MAC 주소는 유일하지 않으며, 동일 네트워크에서 중복되지만 않으면 동작에 문제는 없다.(다른 네트워크로 통신할 때 기존의 출발지 도착지 MAC 주소를 유지하지 않음.)

### MAC 주소 동작
* NIC(네트워크 카드)는 MAC 주소를 가지고 있다가 들어온 전기 신호를 데이터로 변환 후 MAC 주소를 확인한다.
* MAC 주소가 일치하지 않는 패킷은 폐기한다.
* 주소가 일치하거나, 브로드캐스트 주소는 OS나 애플리케이션에서 처리해야하기에 시스템 부하가 작용한다.
* 단말기는 여러 NIC를 통해 여러 MAC 주소를 가질 수 있다.
* 다른 목적지 패킷을 분석하거나 수집하기 위해서는 무차별 모드(promiscuois mode)로 NIC를 구성할 수 있다.

## IP 주소
* IP 주소는 변경 가능하며, 네트워크 주소와 호스트 주소로 구분된다.

### 클래스 기반의 IP 주소 체계
* IP 주소는 호스트 개수에 따라 네트워크 크기를 다르게 할당할 수 있는 클래스 개념을 도입했다. 

| class   | address               | subnet mask   | 호스트 개수  |
|---------|-----------------------|---------------|---------|
| A class | 1.0.0.0 ~ 127.0.0.0   | 255.0.0.0     | 2^24 -2 |
| B class | 128.0.0.0 ~ 191.0.0.0 | 255.255.0.0   | 2^16 -2 |
| C class | 192.0.0.0 ~ 223.0.0.0 | 255.255.255.0 | 2^8 -2  |

* A 클래스의 주소 123.12.43.231을 예로 들면, 123.0.0.0이 네트워크 주소이며, 12.43.231이 호스트 주소이다.
* B 클래스의 주소 174.42.112.33에서는 174.42.0.0이 네트워크 주소이며, 112.33이 호스트 주소이다.
* 서브넷 마스크는 네트워크 주소의 위치를 나타내주는 개념이다. 클래스 기반에서는 클래스 별로 서브넷 마스크가 정해져있다. 이를 통해 클래스 기반에서는 서브넷 마스크를 몰라도, 네트워크 주소와 호스트 주소의 구분이 가능하다.

### 클래스리스 네트워크
* 배경: 인터넷 상용화로 인한 호스트 숫자의 폭발적 증가, IP 주소의 낭비로 인해 3가지 보존, 전환 전략을 세움. 

| 단계  | 내용                                          |
|-----|---------------------------------------------|
| 1단계 | 클래스리스, CIDR(classless inter-domain routing) |
| 2단계 | NAT, 사설 IP 주소                               |
| 3단계 | IPv6                                        |

* 특히 A 클래스를 할당받은 조직에서 주소를 제대로 활용하지 못하는 문제가 발생 -> 클래스 개념 포기 -> 빈 주소를 분할하여 다른 조직에서 사용 가능
* 클래스 기반에서는 서브넷 마스크 없이 네트워크 주소와 호스트 주소의 구분이 가능했지만, 클래스리스에서는 불가능.
* 예를 들어 IP 주소 12.34.56.78, 서브넷 마스크 255.255.16.0인 경우, 비트 연산을 통해 네트워크 주소를 구할 수 있다.
```

     12.34.56.78   : 00001100 . 00100010 . 00111000 . 01001110 (ip 주소)
     255.255.240.0 : 11111111 . 11111111 . 11110000 . 00000000 (서브넷 마스크)
     ---------------------------------------------------------- &&
     12.34.48.0    : 00001100 . 00100010 . 00110000 . 00000000 (네트워크 주소)
     0.0.8.78      : 00000000 . 00000000 . 00001000 . 01001110 (호스트 주소)
     
     12.34.48.1    : 00001100 . 00100010 . 00110000 . 000000001 (첫 번째 주소)
     12.34.63.254  : 00001100 . 00100010 . 00111111 . 111111111 (마지막 주소)
     12.34.63.255  : 00001100 . 00100010 . 00111111 . 111111111 (브로드캐스트 주소)
     사용 가능한 주소 수 : 2^12 - 2 (호스트 주소가 12 비트) - (0, 브로트 캐스트 제외)
     
```

### 서브네팅
* 클래스풀 단위의 네트워크보다 더 쪼개 사용하는 것을 의미한다.
* 위 예시처럼 주소와 서브넷 마스크를 통해 네트워크 주소를 찾고, 브로드 캐스트 주소와 첫 번째 주소, 마지막 주소를 찾을 수 있다.

### 공인 IP, 사설 IP
* IP는 전 세계에서 유일한 실별자이여야 한다.
* 인터넷에 연결하지 않고 개인적으로 네트워크를 구성할 경우에는 IP 할달 없이 사설 ip 주소를 사용할 수 있다.
* 사설 ip를 사용한 상태에서 인터넷에 연결하기 위해서는 NAT(network address translation)를 사용해야 한다.
* 클래스 별로 사설 IP 주소가 1개씩 설정되어 있다.

| 클래스   | 사설 주소                         |
|-------|-------------------------------|
| A 클래스 | 10.0.0.0 ~ 10.255. 255. 255   |
| B 클래스 | 172.16.0.0 ~ 172.31.255.255   |
| C 클래스 | 192.168.0.0 ~ 192.168.255.255 |

* Bogon IP : 사설 IP와 같이 공인 IP로 할당하지 않는 주소를 의미한다.

## TCP & UDP

### TCP(Transmission Control Protocol)
* 세션을 안전하게 연결하고, 데이터를 분할하며, 분할된 패킷이 잘 전송되었는지 확인할 수 있다.
* 패킷에 시퀀스 번호를 부여하고, 전송에 대한 응답을 힌다. 한번에 보낼 데이터 전송 크기(윈도우 사이즈)를 고려한다.
* 데이터 유닛
<사진 첨부>
* 출처 : https://www.technologyuk.net/telecommunications/internet/transport-layer-protocols.shtml

### TCP 데이터 전달 과정

| 송신자                                                                                           | 수신자                                                                                             |
|-----------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------|
| 출발 포트 : 7924<br/>도착 포트 : 80 <br/> SYN<br/>   * SEQ=m,<br/> * LEN=0                            |                                                                                                 |
|                                                                                               | 출발 포트 : 80 <br/>도착 포트 : 7924 <br/> SYN, ACK<br/>   * SEQ=n,<br/> * LEN=0 <br/>  * ACK=m+1 <br/> |
| 출발 포트 : 7924<br/>도착 포트 : 80 <br/> ACK<br/>   * SEQ=m+1, <br/> * ACK= n+1,<br/> * LEN=0        |                                                                                                 |
| 출발 포트 : 7924<br/>도착 포트 : 80 <br/> GET HTTP<br/>   * SEQ=m+1, <br/> * ACK=n+1, <br/> * LEN=562 |                                                                                                 |
|                                                                                               | 출발 포트 : 80 <br/>도착 포트 : 7924 <br/> ACK<br/>   * SEQ=n+1,<br/> * ACK=(m+1)+562, <br/> * LEN=0    |
|                                                                                               | 출발 포트 : 80 <br/>도착 포트 : 7924 <br/> HTTP<br/>   * SEQ=n+1,<br/> *ACK=(m+1)+562, <br/> * LEN=597  |
| 출발 포트 : 7924<br/>도착 포트 : 80 <br/> ACK<br/>   * SEQ=(m+1)+562, <br/> * ACK=(n+1)+597           |                                                                                                 |

* 두 컴퓨터가 최초 통신을 하기 위해서 LEN =0 인 패킷을 주고 받는다.(3way handshake)
* 3 way handshake을 통해 두 컴퓨터는 각자의 seq 번호를 동기화한다.
* 매 요청 시 SEQ는 자신의 seq 번호를, ACK는 상대방의 seq 번호를 담아 보낸다.

### TCP 슬라이드 윈도우
* 윈도 사이즈를 상황에 따라 조절하는 것을 슬라이드 윈도라고 한다.

## ARP


## 참고 자료(Reference)
* 고재성, 이상훈, IT 엔지니어를 위한 네트워크 입문(2020, 길벗)
* 